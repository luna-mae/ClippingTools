// ==UserScript==
// @name         Clipping Tools++
// @description  Clipping tools for clippers
// @author       luna__mae
// @version      3.0.0
// @homepageURL  https://github.com/luna-mae/ClippingTools
// @icon         https://raw.githubusercontent.com/luna-mae/ClippingTools/refs/heads/main/media/logo.png
// @match        https://www.fishtank.live/
// @match        https://www.fishtank.live/clips
// @match        https://www.fishtank.live/clip/*
// @run-at       document-idle
// ==/UserScript==

(()=>{"use strict";const e=()=>{const e=document.querySelector(".ads_ads__Z1cPk");e&&(e.style.display="none")};e();new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0});const n=document.createElement("style");n.type="text/css",n.innerText="\n        .luna-menu {\n            position: fixed;\n            top: 10px;\n            left: 10px;\n            background: rgba(0, 0, 0, 0.7);\n            color: white;\n            padding: 10px;\n            border-radius: 5px;\n            z-index: 10000;\n            cursor: default;\n        }\n        .luna-menu_title {\n            font-weight: bold;\n            margin-bottom: 5px;\n        }\n        .luna-menu_drag-handle {\n            background: rgba(255, 255, 255, 0.1);\n            padding: 5px;\n            cursor: move;\n            margin-bottom: 5px;\n            text-align: center;\n        }\n        .luna-menu_item {\n            margin: 5px 0;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n        }\n        .luna-menu_item label {\n            margin-right: 5px;\n        }\n        .luna-menu_item:hover {\n            text-decoration: underline;\n        }\n        .camera-dropdown {\n            margin: 5px 0;\n        }\n        .camera-dropdown select {\n            width: calc(100% - 24px); /* Adjust width here */\n            padding: 5px;\n            background: rgba(0, 0, 0, 0.7);\n            color: white;\n            border: none;\n            border-radius: 5px;\n        }\n        .luna-hide-scan_lines::after {\n            content: none !important;\n        }\n    ",document.head.appendChild(n);const t={"":"Select Camera:","den-3":"Den","den-ptz-3":"Den PTZ - Pass Only","lounge-3":"Lounge - Pass Only","locker-room-3":"Locker Room","deck-3":"Deck","yard-3":"Yard","yard-ptz-3":"Yard PTZ - Pass Only","catwalk-3":"Catwalk","mail-room-3":"Mail Room","kitchen-3":"Kitchen","island-3":"Island","dining-room-3":"Dining Room","hallway-3":"Hallway","bedroom-1-3":"Bedroom 1","bedroom-2-3":"Bedroom 2","bedroom-3-3":"Bedroom 3","vanity-3":"Vanity","penthouse-3":"Penthouse - Pass Only","loft-3":"Loft - Pass Only","jacuzzi-3":"Jacuzzi - Pass Only","bar-3":"Bar - Pass Only","flat-3":"Flat","confessional-3":"Confessional - Pass Only"},o=[{label:"Enable Full-Screen",action:()=>{const e=document.querySelector("video");e&&e.requestFullscreen()}},{label:"Enable PiP",action:()=>{const e=document.querySelector("video");e&&e.requestPictureInPicture()}},{label:"Toggle Hide Scan Lines",action:()=>{document.body.classList.toggle("luna-hide-scan_lines"),l("luna-checkbox-2",document.body.classList.contains("luna-hide-scan_lines"))}},{label:"Block All SFX",action:()=>{!function(){const e=HTMLAudioElement.prototype.play;HTMLAudioElement.prototype.play=function(){return document.querySelector("#luna-checkbox-3").checked&&a.some((e=>this.src.includes(e)))?(console.log(`Blocking sound effect: ${this.src}`),Promise.resolve()):e.apply(this,arguments)}}()}},{label:"Toggle Clickable Zones",action:()=>{const e=document.querySelector("#clickable-zones-style");if(e)e.disabled=!e.disabled;else{const e=document.createElement("style");e.id="clickable-zones-style",e.innerHTML="\n                    .clickable-zones_clickable-zones__OgYjT polygon.clickable-zones_live-stream__i75zd:hover {\n                        fill: rgba(243, 14, 0, 0) !important;\n                    }\n                ",document.head.appendChild(e)}}}],l=(e,n)=>{localStorage.setItem(e,JSON.stringify(n))},c=e=>JSON.parse(localStorage.getItem(e))||!1,a=["https://cdn.fishtank.live/sounds/","https://cdn.fishtank.live/sfx/"];function s(){const e=document.querySelector(".panel_panel__Tdjid.panel_full-height__2dCSF.panel_no-padding__woODX");if(e){const n=e.querySelector(".live-streams-monitoring-point_list__g0ojU");if(n&&(n.style.maxHeight="none"),e.style.position="relative",e.style.overflow="hidden",e.offsetHeight>0){if(!e.querySelector(".resize-handle")){const n=function(){const e=document.createElement("div");return e.style.width="100%",e.style.height="10px",e.style.background="rgba(116, 0, 0, 0.5)",e.style.cursor="ns-resize",e.style.position="absolute",e.style.left="0",e.style.bottom="0",e.style.zIndex="1000",e.classList.add("resize-handle"),e.addEventListener("mousedown",(n=>{n.preventDefault();const t=e.parentElement,o=t.querySelector(".live-streams-monitoring-point_list__g0ojU"),l=n.clientY,c=t.offsetHeight,a=e=>{const n=c+(e.clientY-l),a=Math.max(100,n);t.style.height=a+"px",o&&(o.style.height=a+"px")},s=()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",s)};document.addEventListener("mousemove",a),document.addEventListener("mouseup",s)})),e}();n.classList.add("resize-handle"),e.appendChild(n)}}}}function i(){const e=setInterval((()=>{document.querySelector(".panel_panel__Tdjid.panel_full-height__2dCSF.panel_no-padding__woODX")&&(s(),clearInterval(e))}),1e3)}window.addEventListener("load",(()=>{i()}));new MutationObserver((()=>{document.querySelector(".panel_panel__Tdjid.panel_full-height__2dCSF.panel_no-padding__woODX .resize-handle")||i()})).observe(document.body,{childList:!0,subtree:!0}),(()=>{const e=document.createElement("div");e.className="luna-menu",e.innerHTML=`\n            <div class="luna-menu_drag-handle">⇕</div>\n            <div class="luna-menu_title">CLIPPING TOOLS <span id="settings-cog">⚙️</span></div>\n            <div id="main-menu">\n                ${o.map(((e,n)=>`\n                    <div class="luna-menu_item" id="menu-item-${n}">\n                        <input type="checkbox" id="luna-checkbox-${n}">\n                        <label for="luna-checkbox-${n}">${e.label}</label>\n                    </div>\n                `)).join("")}\n                <div class="camera-dropdown" id="camera-dropdown">\n                    <select id="camera-select">\n                        ${Object.keys(t).map((e=>`\n                            <option value="${e}">${t[e]}</option>\n                        `)).join("")}\n                    </select>\n                </div>\n            </div>\n            <div id="settings-menu" style="display: none;">\n                ${o.map(((e,n)=>`\n                    <div class="luna-menu_item">\n                        <input type="checkbox" id="settings-checkbox-${n}" checked>\n                        <label for="settings-checkbox-${n}">Show ${e.label}</label>\n                    </div>\n                `)).join("")}\n                <div class="luna-menu_item">\n                    <input type="checkbox" id="settings-checkbox-dropdown" checked>\n                    <label for="settings-checkbox-dropdown">Show Camera Dropdown</label>\n                </div>\n                <div class="luna-menu_item">\n                    <label for="layoutSelector">Layout:</label>\n                    <select id="layoutSelector">\n                        <option value="4x3">4x3 Layout</option>\n                        <option value="6x4">6x4 Layout</option>\n                    </select>\n                </div>\n            </div>\n        `,document.body.appendChild(e);const n=document.getElementById("settings-cog"),a=document.getElementById("main-menu"),s=document.getElementById("settings-menu");function i(e){const n=document.querySelector(".live-streams_live-streams-grid__Tp4ah");n?"4x3"===e?(n.style.gridTemplateColumns="repeat(4, minmax(10vw, 1fr))",n.style.gridAutoRows="5.5vw",console.log("Applied 4x3 layout.")):"6x4"===e?(n.style.gridTemplateColumns="repeat(6, minmax(10vw, 1fr))",n.style.gridAutoRows="5vw",console.log("Applied 6x4 layout.")):console.warn("Unknown layout option selected."):console.warn("Grid container not found.")}function d(){return localStorage.getItem("layoutPreference")||"4x3"}n.addEventListener("click",(()=>{a.style.display="none"===a.style.display?"":"none",s.style.display="none"===s.style.display?"":"none"})),o.forEach(((n,t)=>{const o=e.querySelector(`#luna-checkbox-${t}`),a=c(`luna-checkbox-${t}`);o.checked=a,console.log(`Initial load state: luna-checkbox-${t} = ${a}`),a&&n.action(),o.addEventListener("change",(function(){l(`luna-checkbox-${t}`,this.checked),n.action()}))}));const r=document.getElementById("layoutSelector");r.value=d(),r.addEventListener("change",(e=>{const n=e.target.value;var t;i(n),t=n,localStorage.setItem("layoutPreference",t)})),i(d()),setInterval((()=>{i(d())}),500);o.forEach(((e,n)=>{const t=document.getElementById(`menu-item-${n}`),o=document.getElementById(`settings-checkbox-${n}`),a=c(`settings-checkbox-${n}`);o.checked=a,console.log(`Loaded state: settings-checkbox-${n} = ${a}`),t.style.display=a?"":"none",a&&e.action(),o.addEventListener("change",(()=>{t.style.display=o.checked?"":"none",l(`settings-checkbox-${n}`,o.checked),e.action()}))}));const u=document.getElementById("camera-dropdown"),m=document.getElementById("settings-checkbox-dropdown"),p=c("settings-checkbox-dropdown");m.checked=p,u.style.display=p?"":"none",m.addEventListener("change",(()=>{u.style.display=m.checked?"":"none",l("settings-checkbox-dropdown",m.checked)}));e.querySelector("#camera-select").addEventListener("change",(function(){y(this.value)}));const y=e=>{const n=document.querySelector(".live-stream-player_close__c_GRv");if(n)n.click(),setTimeout((()=>{const n=document.getElementById(e);n&&n.click()}),300);else{const n=document.getElementById(e);n&&n.click()}},g=e.querySelector(".luna-menu_drag-handle");g.onmousedown=function(n){let t=n.clientX-e.getBoundingClientRect().left,o=n.clientY-e.getBoundingClientRect().top;function l(n){var l,c;l=n.pageX,c=n.pageY,e.style.left=l-t+"px",e.style.top=c-o+"px"}document.addEventListener("mousemove",l),g.onmouseup=function(){document.removeEventListener("mousemove",l),g.onmouseup=null}},g.ondragstart=function(){return!1},document.addEventListener("fullscreenchange",(()=>{if(!document.fullscreenElement){const n=e.querySelector("#luna-checkbox-0");n.checked&&(n.checked=!1)}}))})()})();
